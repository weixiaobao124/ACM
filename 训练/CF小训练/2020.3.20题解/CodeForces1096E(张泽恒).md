<hr>

#### <center>[CodeForces 1096E](http://codeforces.com/problemset/problem/1092/E)</center>

**题意：**

有 $S$ 个相同的小球放到 $P$ 个盒子中，第一个盒子至少 $R$ 个，如果一个盒子内小球的数目最多我们称之为好盒子，但是好盒子只能有一个，当数目最多的盒子有多个时， 每个盒子成为好盒子的概率相等。问第一个盒子成为好盒子的概率
$1<P<100 \ ,0\leq R\leq S \leq 5000$

**题解**

枚举第一个盒子中的球的数目设其为 $X$ (最值)

枚举最值的数量设其为 $K$

分配最值(第一个盒子默认最大)：$C(P-1,K-1)$

现在小球剩下 $R = S-K*X$ 个

余下的 $P-K$ 个盒子中放 $R$ 个小球，最大值不能超过 $X-1$

**模型：** $N$ 个相同的小球放到 $M$个不同的盒子中去，每个盒子不超过 $K$ 个。

**模型求解：** 设$S_i$ 表示：第至少i个盒子超出限制的方案集合

运用容斥原理：SUM=全集 - 非法集

$$SUM = C^{M-1}_{N+M-1}- |\bigcup_{i=1}^{M}S_i|$$

如果按照容斥原理定义式子去暴力做是$O(2^M)$，非常局限。

我们考虑合并，采取新的划分方式: $S_i$ 表示至少第 $i$ 个盒子是非法的方案集合。

其中$|S_i|$比较容易计算：$$|S_i|=C_M^{\ i}*C^{M-1}_{N-(K+1)*i+M-1}$$

此时容斥原理：

$SUM=C^{M-1}_{N+M-1}- |\bigcup_{i=1}^{M}S_i|$

$=C^{M-1}_{N+M-1}+\sum_{i=1}^{M}(-1)^{i}|S_i|$

$=C^{M-1}_{N+M-1}+\sum_{i=1}^{M}(-1)^{i}*C^{M-1}_{N-(K+1)*i+M-1}$

$=\sum_{i=0}^{M}(-1)^{i}*C^{M-1}_{N-(K+1)*i+M-1}$

把值代入模型的公式,计算最值为 $X$ 下的概率：

$$ANS(X)=\sum_{k=1}^{P}\frac{C_{P-1}^{K-1}* \sum_{i=0}^{P-K}(-1)^{i}*C^{P-K-1}_{(S-K*X-X*i)+P-K-1}}{K}$$

最后结果：
$$ANS=\sum_{X=R}^{S}\sum_{k=1}^{P}\frac{C_{P-1}^{K-1}* \sum_{i=0}^{P-K}(-1)^{i}*C^{P-K-1}_{(S-K*X-X*i)+P-K-1}}{K}$$

特别地：除法利用到了逆元。

**时间复杂度：**$$O(S*P^2)\approx5e7$$

<hr>

$$x = y$$
